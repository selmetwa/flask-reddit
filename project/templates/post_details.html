{% extends "base.html" %}
{% block content %}
<div class="feed-wrapper">
  <div class="all-posts-wrapper">
  
  <div class="posts-wrapper">
  {% if post %}
    <div class="post">
    {% if current_user.is_authenticated %}
      <div class="post-vote-wrapper">
        <button class="upvote">
          <a href="{{ url_for('main.upvote_post_details', post_id=post.id, user_id=post.user.id) }}">upvote</a>        
        </button>
        <p class='post-votes'>{{post.votes}}</p>
        <button class="downvote">
          <a href="{{ url_for('main.downvote_post_details', post_id=post.id, user_id=post.user.id) }}">downvote</a>
        </button>
      </div>
      {% endif %}
      {% if not current_user.is_authenticated %}
      <div class="post-vote-wrapper">
        <button class="upvote">upvote</button>
        <p class='post-votes'>{{post.votes}}</p>
        <button class="downvote">downvote</button>
      </div>
      {% endif %}
      <div class="post-content-wrapper">
        <a href="{{ url_for('main.post_details', post_id=post.id) }} " class="post-title">{{post.title}}</a>        
        <h3 class='post-description'>{{post.description}}</h3>
        <div class="post-content-footer"> 
          <a href="{{ url_for('main.get_posts_for_subreddit', sub_name=post.sub) }}">{{post.sub}}</a>
          {% if post.user.name == current_user.name %}
          <a href="{{ url_for('main.profile', user_id=current_user.id) }}" class="post-author">
              {{ current_user.name }}
          </a>
          {% else %}
          <a href="{{ url_for('main.user_profile', user_id=post.user.id) }}" class="post-author">by {{post.user.name}}</a>
          {% endif %}
        </div>
      </div>
    </div>
    {% include "create_comment_form.html" %}
    <div class='comments-wrapper'>
    {% for comment in comments%}
    <div class="comment-wrapper">
    {% if current_user.is_authenticated %}
    <div class="post-vote-wrapper">
        <button class="upvote">
          <a href="{{ url_for('main.upvote_comment', post_id=post.id, user_id=post.user.id, comment_id=comment.id) }}">upvote</a>        
        </button>
        <p class='post-votes'>{{comment.votes}}</p>
        <button class="downvote">
          <a href="{{ url_for('main.downvote_comment', post_id=post.id, user_id=post.user.id, comment_id=comment.id) }}">downvote</a>
        </button>
      </div>
      {% endif %}
      {% if not current_user.is_authenticated %}
      <div class="post-vote-wrapper">
        <button class="upvote">upvote</button>
        <p class='post-votes'>{{comment.votes}}</p>
        <button class="downvote">downvote</button>
      </div>
      {% endif %}
      {% if comment.author == current_user.name %}
      <a href="{{ url_for('main.profile', user_id=current_user.id) }}" class="post-author">
          {{ comment.author }}
      </a>
      {% else %}
      <a href="{{ url_for('main.user_profile', user_id=comment.user_id) }}" class="post-author">by {{comment.author}}</a>
      {% endif %}
    <p>{{comment.text}}</p>
    <p>{{comment.timestamp}}</p>
    </div>
    {% endfor %}
    </div>
  {% endif %}
  </div>
  </div>
  <div class="subreddits-wrapper">
    <a href="{{ url_for('main.create_post_form') }}">create post</a>
    <div class='subreddits-wrapper'>
    <a href="{{ url_for('main.get_all_posts') }}">All</a>
    {% if subreddits %}
    {% for subreddit in subreddits %}
    <div class="subreddit-container">
      <a href="{{ url_for('main.get_posts_for_subreddit', sub_name=subreddit.name) }}">{{subreddit.name}}</a>
    </div>
    {% endfor %}
  {% endif %}
    </div>
    </div>
</div>
{% endblock %}